<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"

        "http://www.w3.org/TR/html4/loose.dtd">



<html lang="en">

<head>


    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Title Goes Here</title>
    <script type='text/javascript' src='http://d3js.org/d3.v3.min.js'></script>
    <script type='text/javascript'>
        window.onload = function(){

            // var dataset = [{name: "hehe", value: 90}];

            setInterval(function () {
                d3.json("http://localhost:2000/server.n?json", function(error, json) {
                    // if (error) return console.warn(error);
                    // console.log(error);
                    // console.log(json);
                    dataset = json;
                    // var json = JSON.parse(json);
                    // console.log(json);
                    update(json);
                });
            }, 1000);
            

            // d3.select("body").append("p").text("Hello, world!");


            // var dataset = [{name: "hehe", value: 90}];


            var width = 500;
            var height = 200;
            var barHeight = 20;

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

            var graphx = 100;

            function update(dataset)
            {
                console.log("update");
                console.log(dataset);

                var rects = svg.selectAll("rect")
                    .data(dataset);

                rects.attr("x", graphx)
                    .attr("y", function(d, i) {
                        return i * barHeight;
                    })
                    .attr("width", function(d) {
                        console.log(d);
                        return d.value;
                    })
                    .attr("height", barHeight - 1);
                    // .attr("x", 0)
                    // .attr("y", 0)
                    // .attr("width", width)
                    // .attr("height", barHeight);

                rects.exit().remove();
                    

                rects.enter()
                    .append("rect")



                var texts = svg.selectAll("text")
                    .data(dataset)

                texts.enter()
                    .append("text");

                texts.text(function(d) {
                        return d.value + " ms";
                    })
                    .attr("x", graphx)
                    .attr("y", function(d, i) {
                        return i * barHeight + 10;
                    })
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "11px")
                    .attr("fill", "white");

                texts.enter()
                    .append("text")
                    .text(function(d) {
                        return d.name;
                    })
                    .attr("x", 0)
                    .attr("y", function(d, i) {
                        return i * barHeight + 10;
                    })
                    .attr("font-family", "sans-serif")
                    .attr("font-size", "11px")
                    .attr("fill", "black");
            }
 
        }
    </script>


</head>


<body>

<!-- <canvas id="myChart" width="400" height="400"></canvas> -->


<p>This is my web page</p>

</body>

</html>


